<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<HTML>
<HEAD>
	<META HTTP-EQUIV="CONTENT-TYPE" CONTENT="text/html; charset=utf-8">
	<TITLE></TITLE>
	<META NAME="GENERATOR" CONTENT="LibreOffice 4.1.3.2 (Linux)">
	<META NAME="CREATED" CONTENT="20140406;205616710170649">
	<META NAME="CHANGED" CONTENT="20140406;231513797812719">
	<STYLE TYPE="text/css">
	<!--
		@page { margin: 2cm }
		P { margin-bottom: 0.21cm }
		A:link { so-language: zxx }
	-->
	</STYLE>
</HEAD>
<BODY LANG="ru-RU" DIR="LTR">
<P ALIGN=CENTER STYLE="margin-bottom: 0cm"><FONT FACE="Ubuntu"><FONT SIZE=4>Структура
драйвера</FONT></FONT></P>
<P ALIGN=LEFT STYLE="margin-bottom: 0cm"><FONT FACE="Ubuntu"><FONT SIZE=4>Драйвер
состоит из:</FONT></FONT></P>
<UL>
	<LI><P ALIGN=LEFT STYLE="margin-bottom: 0cm"><FONT FACE="Ubuntu"><FONT SIZE=4>4-х
	логических частей:</FONT></FONT></P>
</UL>
<UL>
	<LI><P ALIGN=LEFT STYLE="margin-bottom: 0cm"><FONT FACE="Ubuntu"><FONT SIZE=4>Символьное
	устройство;</FONT></FONT></P>
	<LI><P ALIGN=LEFT STYLE="margin-bottom: 0cm"><FONT FACE="Ubuntu"><FONT SIZE=4>Работа
	с процессами;</FONT></FONT></P>
	<LI><P ALIGN=LEFT STYLE="margin-bottom: 0cm"><FONT FACE="Ubuntu"><FONT SIZE=4>Обработчик
	команд;</FONT></FONT></P>
	<LI><P ALIGN=LEFT STYLE="margin-bottom: 0cm"><FONT FACE="Ubuntu"><FONT SIZE=4>Инициализация
	самого драйвера</FONT></FONT></P>
</UL>
<UL>
	<LI><P ALIGN=LEFT STYLE="margin-bottom: 0cm"><FONT FACE="Ubuntu"><FONT SIZE=4>6-и
	файлов:</FONT></FONT></P>
</UL>
<UL>
	<LI><P ALIGN=LEFT STYLE="margin-bottom: 0cm"><FONT FACE="Ubuntu"><FONT SIZE=4>affl_char_dev.h;</FONT></FONT></P>
	<LI><P ALIGN=LEFT STYLE="margin-bottom: 0cm"><FONT FACE="Ubuntu"><FONT SIZE=4>affl_char_dev.c;</FONT></FONT></P>
	<LI><P ALIGN=LEFT STYLE="margin-bottom: 0cm"><FONT FACE="Ubuntu"><FONT SIZE=4>affl_process.h;</FONT></FONT></P>
	<LI><P ALIGN=LEFT STYLE="margin-bottom: 0cm"><FONT FACE="Ubuntu"><FONT SIZE=4>affl_procecc.c;</FONT></FONT></P>
	<LI><P ALIGN=LEFT STYLE="margin-bottom: 0cm"><FONT FACE="Ubuntu"><FONT SIZE=4>affl_main.h;</FONT></FONT></P>
	<LI><P ALIGN=LEFT STYLE="margin-bottom: 0cm"><FONT FACE="Ubuntu"><FONT SIZE=4>afffl_main.c;</FONT></FONT></P>
</UL>
<UL>
	<LI><P ALIGN=LEFT STYLE="margin-bottom: 0cm"><FONT FACE="Ubuntu"><FONT SIZE=4>26
	функций</FONT></FONT></P>
</UL>
<UL>
	<LI><P ALIGN=LEFT STYLE="margin-bottom: 0cm"><FONT FACE="Ubuntu"><FONT SIZE=4><FONT COLOR="#7f0055"><B>int</B></FONT><FONT COLOR="#000000">
	</FONT><FONT COLOR="#333333"><U><B>affl_open</B></U></FONT><FONT COLOR="#000000">(</FONT><FONT COLOR="#7f0055"><B>struct</B></FONT><FONT COLOR="#000000">
	inode *i, </FONT><FONT COLOR="#7f0055"><B>struct</B></FONT><FONT COLOR="#000000">
	file *f);</FONT></FONT></FONT></P>
	<LI><P ALIGN=LEFT STYLE="margin-bottom: 0cm"><FONT FACE="Ubuntu"><FONT SIZE=4><FONT COLOR="#7f0055"><B>int</B></FONT><FONT COLOR="#000000">
	</FONT><FONT COLOR="#000000"><B>affl_close</B></FONT><FONT COLOR="#000000">(</FONT><FONT COLOR="#7f0055"><B>struct</B></FONT><FONT COLOR="#000000">
	inode *i, </FONT><FONT COLOR="#7f0055"><B>struct</B></FONT><FONT COLOR="#000000">
	file *f);</FONT></FONT></FONT></P>
	<LI><P ALIGN=LEFT STYLE="margin-bottom: 0cm"><FONT FACE="Ubuntu"><FONT SIZE=4><FONT COLOR="#005032">ssize_t</FONT><FONT COLOR="#000000">
	</FONT><FONT COLOR="#000000"><B>affl_read</B></FONT><FONT COLOR="#000000">(</FONT><FONT COLOR="#7f0055"><B>struct</B></FONT><FONT COLOR="#000000">
	file *f, </FONT><FONT COLOR="#7f0055"><B>char</B></FONT><FONT COLOR="#000000">
	__user *buf, </FONT><FONT COLOR="#005032">size_t</FONT><FONT COLOR="#000000">
	len, </FONT><FONT COLOR="#005032">loff_t</FONT><FONT COLOR="#000000">
	*off);</FONT></FONT></FONT></P>
	<LI><P ALIGN=LEFT STYLE="margin-bottom: 0cm"><FONT FACE="Ubuntu"><FONT SIZE=4><FONT COLOR="#333333"><U>ssize_t</U></FONT><FONT COLOR="#000000">
	</FONT><FONT COLOR="#000000"><B>affl_write</B></FONT><FONT COLOR="#000000">(</FONT><FONT COLOR="#7f0055"><B>struct</B></FONT><FONT COLOR="#000000">
	file *f, </FONT><FONT COLOR="#7f0055"><B>const</B></FONT><FONT COLOR="#000000">
	</FONT><FONT COLOR="#7f0055"><B>char</B></FONT><FONT COLOR="#000000">
	__user *buf, </FONT><FONT COLOR="#005032">size_t</FONT><FONT COLOR="#000000">
	len, </FONT><FONT COLOR="#005032">loff_t</FONT><FONT COLOR="#000000">
	*off);</FONT></FONT></FONT></P>
	<LI><P ALIGN=LEFT STYLE="margin-bottom: 0cm"><FONT FACE="Ubuntu"><FONT SIZE=4><FONT COLOR="#7f0055"><B>int</B></FONT><FONT COLOR="#000000">
	</FONT><FONT COLOR="#000000"><B>affl_init_char_dev</B></FONT><FONT COLOR="#000000">(</FONT><FONT COLOR="#7f0055"><B>const</B></FONT><FONT COLOR="#000000">
	</FONT><FONT COLOR="#7f0055"><B>char</B></FONT><FONT COLOR="#000000">*
	file_name, </FONT><FONT COLOR="#7f0055"><B>const</B></FONT><FONT COLOR="#000000">
	</FONT><FONT COLOR="#7f0055"><B>char</B></FONT><FONT COLOR="#000000">*
	device_name);</FONT></FONT></FONT></P>
	<LI><P ALIGN=LEFT STYLE="margin-bottom: 0cm"><FONT FACE="Ubuntu"><FONT SIZE=4><FONT COLOR="#7f0055"><B>void</B></FONT><FONT COLOR="#000000">
	</FONT><FONT COLOR="#000000"><B>affl_clean_char_dev</B></FONT><FONT COLOR="#000000">(</FONT><FONT COLOR="#7f0055"><B>void</B></FONT><FONT COLOR="#000000">);</FONT></FONT></FONT></P>
	<LI><P ALIGN=LEFT STYLE="margin-bottom: 0cm"><FONT FACE="Ubuntu"><FONT SIZE=4><FONT COLOR="#7f0055"><B>int</B></FONT><FONT COLOR="#000000">
	</FONT><FONT COLOR="#000000"><B>affl_init_process</B></FONT><FONT COLOR="#000000">(</FONT><FONT COLOR="#7f0055"><B>void</B></FONT><FONT COLOR="#000000">);</FONT></FONT></FONT></P>
	<LI><P ALIGN=LEFT STYLE="margin-bottom: 0cm"><FONT FACE="Ubuntu"><FONT SIZE=4><FONT COLOR="#7f0055"><B>void</B></FONT><FONT COLOR="#000000">
	</FONT><FONT COLOR="#000000"><B>affl_clean_process</B></FONT><FONT COLOR="#000000">(</FONT><FONT COLOR="#7f0055"><B>void</B></FONT><FONT COLOR="#000000">);</FONT></FONT></FONT></P>
	<LI><P ALIGN=LEFT STYLE="margin-bottom: 0cm"><FONT FACE="Ubuntu"><FONT SIZE=4><FONT COLOR="#7f0055"><B>unsigned</B></FONT><FONT COLOR="#000000">
	</FONT><FONT COLOR="#7f0055"><B>int</B></FONT><FONT COLOR="#000000">
	</FONT><FONT COLOR="#000000"><B>affl_handle</B></FONT><FONT COLOR="#000000">(</FONT><FONT COLOR="#7f0055"><B>const</B></FONT><FONT COLOR="#000000">
	</FONT><FONT COLOR="#7f0055"><B>char</B></FONT><FONT COLOR="#000000">*
	input,  </FONT><FONT COLOR="#7f0055"><B>char</B></FONT><FONT COLOR="#000000">*
	user_buf);</FONT></FONT></FONT></P>
	<LI><P ALIGN=LEFT STYLE="margin-bottom: 0cm"><FONT FACE="Ubuntu"><FONT SIZE=4><FONT COLOR="#7f0055"><B>void</B></FONT><FONT COLOR="#000000">*
	</FONT><FONT COLOR="#000000"><B>find_sym</B></FONT><FONT COLOR="#000000">(</FONT><FONT COLOR="#7f0055"><B>const</B></FONT><FONT COLOR="#000000">
	</FONT><FONT COLOR="#7f0055"><B>char</B></FONT><FONT COLOR="#000000">
	*sym);</FONT></FONT></FONT></P>
	<LI><P ALIGN=LEFT STYLE="margin-bottom: 0cm"><FONT FACE="Ubuntu"><FONT SIZE=4><FONT COLOR="#7f0055"><B>int</B></FONT><FONT COLOR="#000000">
	</FONT><FONT COLOR="#000000"><B>affl_get_proc_name</B></FONT><FONT COLOR="#000000">(</FONT><FONT COLOR="#7f0055"><B>const</B></FONT><FONT COLOR="#000000">
	</FONT><FONT COLOR="#7f0055"><B>char</B></FONT><FONT COLOR="#000000">*
	input, </FONT><FONT COLOR="#7f0055"><B>char</B></FONT><FONT COLOR="#000000">**
	proc_name);</FONT></FONT></FONT></P>
	<LI><P ALIGN=LEFT STYLE="margin-bottom: 0cm"><FONT FACE="Ubuntu"><FONT SIZE=4><FONT COLOR="#7f0055"><B>int</B></FONT><FONT COLOR="#000000">
	</FONT><FONT COLOR="#000000"><B>affl_get_proc_PID</B></FONT><FONT COLOR="#000000">(</FONT><FONT COLOR="#7f0055"><B>const</B></FONT><FONT COLOR="#000000">
	</FONT><FONT COLOR="#7f0055"><B>char</B></FONT><FONT COLOR="#000000">*
	input, </FONT><FONT COLOR="#7f0055"><B>int</B></FONT><FONT COLOR="#000000">*
	PID);</FONT></FONT></FONT></P>
	<LI><P ALIGN=LEFT STYLE="margin-bottom: 0cm"><FONT FACE="Ubuntu"><FONT SIZE=4><FONT COLOR="#7f0055"><B>int</B></FONT><FONT COLOR="#000000">
	</FONT><FONT COLOR="#000000"><B>affl_get_task</B></FONT><FONT COLOR="#000000">(</FONT><FONT COLOR="#7f0055"><B>void</B></FONT><FONT COLOR="#000000">);</FONT></FONT></FONT></P>
	<LI><P ALIGN=LEFT STYLE="margin-bottom: 0cm"><FONT FACE="Ubuntu"><FONT SIZE=4><FONT COLOR="#7f0055"><B>int</B></FONT><FONT COLOR="#000000">
	</FONT><FONT COLOR="#000000"><B>affl_get_quantity_tasks</B></FONT><FONT COLOR="#000000">(</FONT><FONT COLOR="#7f0055"><B>void</B></FONT><FONT COLOR="#000000">);</FONT></FONT></FONT></P>
	<LI><P ALIGN=LEFT STYLE="margin-bottom: 0cm"><FONT FACE="Ubuntu"><FONT SIZE=4><FONT COLOR="#7f0055"><B>int</B></FONT><FONT COLOR="#000000">
	</FONT><FONT COLOR="#000000"><B>affl_get_black_list</B></FONT><FONT COLOR="#000000">(</FONT><FONT COLOR="#7f0055"><B>char</B></FONT><FONT COLOR="#000000">*
	user_buf);</FONT></FONT></FONT></P>
	<LI><P ALIGN=LEFT STYLE="margin-bottom: 0cm"><FONT FACE="Ubuntu"><FONT SIZE=4><FONT COLOR="#7f0055"><B>int</B></FONT><FONT COLOR="#000000">
	</FONT><FONT COLOR="#000000"><B>affl_get_info_for_process</B></FONT><FONT COLOR="#000000">(</FONT><FONT COLOR="#7f0055"><B>int</B></FONT><FONT COLOR="#000000">
	pid, </FONT><FONT COLOR="#7f0055"><B>char</B></FONT><FONT COLOR="#000000">*
	user_buf);</FONT></FONT></FONT></P>
	<LI><P ALIGN=LEFT STYLE="margin-bottom: 0cm"><FONT FACE="Ubuntu"><FONT SIZE=4><FONT COLOR="#7f0055"><B>unsigned</B></FONT><FONT COLOR="#000000">
	</FONT><FONT COLOR="#7f0055"><B>int</B></FONT><FONT COLOR="#000000">
	</FONT><FONT COLOR="#000000"><B>affl_view_process</B></FONT><FONT COLOR="#000000">(</FONT><FONT COLOR="#7f0055"><B>char</B></FONT><FONT COLOR="#000000">*
	user_buf);</FONT></FONT></FONT></P>
	<LI><P ALIGN=LEFT STYLE="margin-bottom: 0cm"><FONT FACE="Ubuntu"><FONT SIZE=4><FONT COLOR="#7f0055"><B>int</B></FONT><FONT COLOR="#000000">
	</FONT><FONT COLOR="#000000"><B>affl_kill_process</B></FONT><FONT COLOR="#000000">(</FONT><FONT COLOR="#7f0055"><B>const</B></FONT><FONT COLOR="#000000">
	</FONT><FONT COLOR="#7f0055"><B>char</B></FONT><FONT COLOR="#000000">*
	name, </FONT><FONT COLOR="#7f0055"><B>int</B></FONT><FONT COLOR="#000000">
	PID);</FONT></FONT></FONT></P>
	<LI><P ALIGN=LEFT STYLE="margin-bottom: 0cm"><FONT FACE="Ubuntu"><FONT SIZE=4><FONT COLOR="#7f0055"><B>int</B></FONT><FONT COLOR="#000000">
	</FONT><FONT COLOR="#000000"><B>affl_from_name_to_pid</B></FONT><FONT COLOR="#000000">(</FONT><FONT COLOR="#7f0055"><B>char</B></FONT><FONT COLOR="#000000">*
	name);</FONT></FONT></FONT></P>
	<LI><P ALIGN=LEFT STYLE="margin-bottom: 0cm"><FONT FACE="Ubuntu"><FONT SIZE=4><FONT COLOR="#7f0055"><B>int</B></FONT><FONT COLOR="#000000">
	</FONT><FONT COLOR="#000000"><B>affl_exist</B></FONT><FONT COLOR="#000000">(</FONT><FONT COLOR="#7f0055"><B>char</B></FONT><FONT COLOR="#000000">*
	user_buf);</FONT></FONT></FONT></P>
	<LI><P ALIGN=LEFT STYLE="margin-bottom: 0cm"><FONT FACE="Ubuntu"><FONT SIZE=4><FONT COLOR="#7f0055"><B>void</B></FONT><FONT COLOR="#000000">
	</FONT><FONT COLOR="#000000"><B>affl_bl_print</B></FONT><FONT COLOR="#000000">(</FONT><FONT COLOR="#7f0055"><B>void</B></FONT><FONT COLOR="#000000">);</FONT></FONT></FONT></P>
	<LI><P ALIGN=LEFT STYLE="margin-bottom: 0cm"><FONT FACE="Ubuntu"><FONT SIZE=4><FONT COLOR="#7f0055"><B>int</B></FONT><FONT COLOR="#000000">
	</FONT><FONT COLOR="#000000"><B>affl_bl_add</B></FONT><FONT COLOR="#000000">(</FONT><FONT COLOR="#7f0055"><B>char</B></FONT><FONT COLOR="#000000">*
	arg);</FONT></FONT></FONT></P>
	<LI><P ALIGN=LEFT STYLE="margin-bottom: 0cm"><FONT FACE="Ubuntu"><FONT SIZE=4><FONT COLOR="#7f0055"><B>int</B></FONT><FONT COLOR="#000000">
	</FONT><FONT COLOR="#000000"><B>affl_bl_rm</B></FONT><FONT COLOR="#000000">(</FONT><FONT COLOR="#7f0055"><B>char</B></FONT><FONT COLOR="#000000">*
	arg);</FONT></FONT></FONT></P>
	<LI><P ALIGN=LEFT STYLE="margin-bottom: 0cm"><FONT FACE="Ubuntu"><FONT SIZE=4><FONT COLOR="#7f0055"><B>int</B></FONT><FONT COLOR="#000000">
	</FONT><FONT COLOR="#000000"><B>affl_bl_cmp</B></FONT><FONT COLOR="#000000">(</FONT><FONT COLOR="#7f0055"><B>const</B></FONT><FONT COLOR="#000000">
	</FONT><FONT COLOR="#7f0055"><B>char</B></FONT><FONT COLOR="#000000">*
	arg);</FONT></FONT></FONT></P>
	<LI><P ALIGN=LEFT STYLE="margin-bottom: 0cm"><FONT FACE="Ubuntu"><FONT SIZE=4><FONT COLOR="#7f0055"><B>void</B></FONT><FONT COLOR="#000000">
	</FONT><FONT COLOR="#000000"><B>affl_add_list_process_mass</B></FONT><FONT COLOR="#000000">(</FONT><FONT COLOR="#7f0055"><B>const</B></FONT><FONT COLOR="#000000">
	</FONT><FONT COLOR="#7f0055"><B>char</B></FONT><FONT COLOR="#000000">*
	proc_name, </FONT><FONT COLOR="#7f0055"><B>int</B></FONT><FONT COLOR="#000000">
	PID);</FONT></FONT></FONT></P>
	<P ALIGN=CENTER STYLE="margin-bottom: 0cm"><FONT FACE="Ubuntu"><FONT SIZE=4>Описание
	функций</FONT></FONT></P>
	<P ALIGN=CENTER STYLE="margin-bottom: 0cm"></P>
</UL>
<P ALIGN=LEFT STYLE="margin-bottom: 0cm"><FONT FACE="Ubuntu"><FONT SIZE=4><FONT COLOR="#7f0055"><B>	int</B></FONT><FONT COLOR="#000000">
</FONT><FONT COLOR="#000000"><B>affl_open</B></FONT><FONT COLOR="#000000">(</FONT><FONT COLOR="#7f0055"><B>struct</B></FONT><FONT COLOR="#000000">
</FONT><FONT COLOR="#333333"><U>inode</U></FONT><FONT COLOR="#000000">
*i, </FONT><FONT COLOR="#7f0055"><B>struct</B></FONT><FONT COLOR="#000000">
file *f):</FONT></FONT></FONT></P>
<P ALIGN=LEFT STYLE="margin-bottom: 0cm"><FONT FACE="Ubuntu"><FONT SIZE=4><FONT COLOR="#000000">	О</FONT><FONT COLOR="#000000">пределение
лежит в файле affl_char_dev.c, объявление лежит
в файле affl_char_dev.h.</FONT></FONT></FONT></P>
<P ALIGN=LEFT STYLE="margin-bottom: 0cm"><FONT FACE="Ubuntu"><FONT SIZE=4><FONT COLOR="#000000">П</FONT><FONT COLOR="#000000">араметры
i и f передаются системой.</FONT></FONT></FONT></P>
<P ALIGN=LEFT STYLE="margin-bottom: 0cm"><FONT FACE="Ubuntu"><FONT SIZE=4><FONT COLOR="#000000">Это
перегрузка системной функции для файла
символьного устройства, </FONT><FONT COLOR="#000000">при
открытии файла устройства будет
вызываться эта функция и инкрементировать
счетчик открытий.</FONT></FONT></FONT></P>
<P ALIGN=LEFT STYLE="margin-bottom: 0cm"><BR>
</P>
<P ALIGN=LEFT STYLE="margin-bottom: 0cm"><FONT FACE="Ubuntu"><FONT SIZE=4><FONT COLOR="#000000">	</FONT><FONT COLOR="#7f0055"><B>int</B></FONT><FONT COLOR="#000000">
</FONT><FONT COLOR="#000000"><B>affl_close</B></FONT><FONT COLOR="#000000">(</FONT><FONT COLOR="#7f0055"><B>struct</B></FONT><FONT COLOR="#000000">
inode *i, </FONT><FONT COLOR="#7f0055"><B>struct</B></FONT><FONT COLOR="#000000">
file *f);</FONT></FONT></FONT></P>
<P ALIGN=LEFT STYLE="margin-bottom: 0cm"><FONT FACE="Ubuntu"><FONT SIZE=4><FONT COLOR="#000000">	О</FONT><FONT COLOR="#000000">пределение
лежит в файле affl_char_dev.c, объявление лежит
в файле affl_char_dev.h.</FONT></FONT></FONT></P>
<P ALIGN=LEFT STYLE="margin-bottom: 0cm"><FONT FACE="Ubuntu"><FONT SIZE=4><FONT COLOR="#000000">П</FONT><FONT COLOR="#000000">араметры
i и f передаются системой.</FONT></FONT></FONT></P>
<P ALIGN=LEFT STYLE="margin-bottom: 0cm"><FONT FACE="Ubuntu"><FONT SIZE=4><FONT COLOR="#000000">Это
перегрузка системной функции для файла
символьного устройства, </FONT><FONT COLOR="#000000">при
закрытии файла устройства будет
вызываться эта функция и декркментировать
счетчик открытий.</FONT></FONT></FONT></P>
<P ALIGN=LEFT STYLE="margin-bottom: 0cm"><BR>
</P>
<P ALIGN=LEFT STYLE="margin-bottom: 0cm"><FONT FACE="Ubuntu"><FONT SIZE=4><FONT COLOR="#000000">	</FONT><FONT COLOR="#005032">ssize_t</FONT><FONT COLOR="#000000">
</FONT><FONT COLOR="#000000"><B>affl_read</B></FONT><FONT COLOR="#000000">(</FONT><FONT COLOR="#7f0055"><B>struct</B></FONT><FONT COLOR="#000000">
file *f, </FONT><FONT COLOR="#7f0055"><B>char</B></FONT><FONT COLOR="#000000">
__user *buf, </FONT><FONT COLOR="#005032">size_t</FONT><FONT COLOR="#000000">
	len, </FONT><FONT COLOR="#005032">loff_t</FONT><FONT COLOR="#000000">
*off).</FONT></FONT></FONT></P>
<P ALIGN=LEFT STYLE="margin-bottom: 0cm"><FONT FACE="Ubuntu"><FONT SIZE=4><FONT COLOR="#000000">	</FONT><FONT COLOR="#000000">О</FONT><FONT COLOR="#000000">пределение
лежит в файле affl_char_dev.c, объявление лежит
в файле affl_char_dev.h.</FONT></FONT></FONT></P>
<P ALIGN=LEFT STYLE="margin-bottom: 0cm"><FONT FACE="Ubuntu"><FONT SIZE=4><FONT COLOR="#000000">В</FONT><FONT COLOR="#000000">се
входные параметры передаются системой,
возвращает количество считанных
символов.</FONT></FONT></FONT></P>
<P ALIGN=LEFT STYLE="margin-bottom: 0cm"><FONT FACE="Ubuntu"><FONT SIZE=4><FONT COLOR="#000000">Это
перегрузка системной функции для файла
символьного устройства, </FONT><FONT COLOR="#000000">копирует
содержимое </FONT><FONT COLOR="#000000">buf в глобальную
переменную ядра </FONT><FONT COLOR="#7f0055"><B>char</B></FONT><FONT COLOR="#000000">
affl_kernel_buf[255]</FONT><FONT COLOR="#000000"> и передает
указатель на копию buf, функции</FONT><FONT COLOR="#000000">
affl_handle(</FONT><FONT COLOR="#7f0055"><B>const</B></FONT><FONT COLOR="#000000">
</FONT><FONT COLOR="#7f0055"><B>char</B></FONT><FONT COLOR="#000000">*
input, </FONT><FONT COLOR="#7f0055"><B>char</B></FONT><FONT COLOR="#000000">*
user_buf)</FONT><FONT COLOR="#000000">, также в эту функцию
передается </FONT><FONT COLOR="#000000">сам</FONT><FONT COLOR="#000000">
buf для возможности записи в файл из
</FONT><FONT COLOR="#000000">affl_handle(</FONT><FONT COLOR="#7f0055"><B>const</B></FONT><FONT COLOR="#000000">
</FONT><FONT COLOR="#7f0055"><B>char</B></FONT><FONT COLOR="#000000">*
input, </FONT><FONT COLOR="#7f0055"><B>char</B></FONT><FONT COLOR="#000000">*
user_buf)</FONT><FONT COLOR="#000000">.</FONT></FONT></FONT></P>
<P ALIGN=LEFT STYLE="margin-bottom: 0cm"><BR>
</P>
<P ALIGN=LEFT STYLE="margin-bottom: 0cm"><FONT FACE="Ubuntu"><FONT SIZE=4><FONT COLOR="#000000">	</FONT><FONT COLOR="#333333"><U>ssize_t</U></FONT><FONT COLOR="#000000">
</FONT><FONT COLOR="#000000"><B>affl_write</B></FONT><FONT COLOR="#000000">(</FONT><FONT COLOR="#7f0055"><B>struct</B></FONT><FONT COLOR="#000000">
file *f, </FONT><FONT COLOR="#7f0055"><B>const</B></FONT><FONT COLOR="#000000">
</FONT><FONT COLOR="#7f0055"><B>char</B></FONT><FONT COLOR="#000000">
__user *buf, </FONT><FONT COLOR="#005032">size_t</FONT><FONT COLOR="#000000">
len, </FONT><FONT COLOR="#005032">loff_t</FONT><FONT COLOR="#000000">
*off)</FONT></FONT></FONT></P>
<P ALIGN=LEFT STYLE="margin-bottom: 0cm"><FONT FACE="Ubuntu"><FONT SIZE=4><FONT COLOR="#000000">	</FONT><FONT COLOR="#000000">О</FONT><FONT COLOR="#000000">пределение
лежит в файле affl_char_dev.c, объявление лежит
в файле affl_char_dev.h.</FONT></FONT></FONT></P>
<P ALIGN=LEFT STYLE="margin-bottom: 0cm"><FONT FACE="Ubuntu"><FONT SIZE=4><FONT COLOR="#000000">В</FONT><FONT COLOR="#000000">се
входные параметры передаются системой,
возвращает количество считанных
символов.</FONT></FONT></FONT></P>
<P ALIGN=LEFT STYLE="margin-bottom: 0cm"><FONT FACE="Ubuntu"><FONT SIZE=4><FONT COLOR="#000000">Это
перегрузка системной функции для файла
символьного устройства, </FONT><FONT COLOR="#000000">копирует
содержимое </FONT><FONT COLOR="#000000">переменной
buf пользовательского пространства</FONT><FONT COLOR="#000000">
в </FONT><FONT COLOR="#000000">переменную ядерного
пространства, также копирует количество
записанных символов в глобальную
переменную </FONT><FONT COLOR="#7f0055"><B>int</B></FONT><FONT COLOR="#000000">
affl_size</FONT><FONT COLOR="#000000">.</FONT></FONT></FONT></P>
<P ALIGN=LEFT STYLE="margin-bottom: 0cm"><FONT FACE="Ubuntu"><FONT SIZE=4><FONT COLOR="#000000">.	</FONT><FONT COLOR="#7f0055"><B>int</B></FONT><FONT COLOR="#000000">
</FONT><FONT COLOR="#000000"><B>affl_init_char_dev</B></FONT><FONT COLOR="#000000">(</FONT><FONT COLOR="#7f0055"><B>const</B></FONT><FONT COLOR="#000000">
</FONT><FONT COLOR="#7f0055"><B>char</B></FONT><FONT COLOR="#000000">*
file_name, </FONT><FONT COLOR="#7f0055"><B>const</B></FONT><FONT COLOR="#000000">
</FONT><FONT COLOR="#7f0055"><B>char</B></FONT><FONT COLOR="#000000">*
device_name)</FONT></FONT></FONT></P>
<P ALIGN=LEFT STYLE="margin-bottom: 0cm"><FONT FACE="Ubuntu"><FONT SIZE=4><FONT COLOR="#000000">	</FONT></FONT></FONT></P>
</BODY>
</HTML>